#!/bin/bash
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# 0.0.1
# Alexey Potehin <gnuplanet@gmail.com>, http://www.gnuplanet.ru/doc/cv
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# check depends
function check_prog()
{
	for i in ${1};
	do
		if [ "$(command -v ${i})" == "" ];
		then
			echo "FATAL: you must install \"${i}\"...";
			return 1;
		fi
	done

	return 0;
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# list all
function list()
{
	if [ ! -d /usr/bin ];
	then
		echo "ERROR: dir /usr/bin is not found";
		return 1;
	fi
	cd /usr/bin;


	ls -1 | grep ^gcc\-[0-9];


	echo;


	ls -1 | grep ^g++\-[0-9];


	return 0;
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
function set_internal()
{
	local VER;
	local SOURCE;
	local TARGET;

	VER="${1}";
	SOURCE="${3}${VER}";
	TARGET="${2}";


	if [ "${FLAG_DEBUG}" == "1" ];
	then
		echo "======================";
		echo "VER:    \"${VER}\"";
		echo "SOURCE: \"${SOURCE}\"";
		echo "TARGET: \"${TARGET}\"";
	fi


	if [ ! -f "${SOURCE}" ];
	then
		echo "ERROR: source is not found";
		return 1;
	fi


	ln -sf "${SOURCE}" "${TARGET}";


	return 0;
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# set
function set()
{
	local VER;
	VER="${1}";
	echo "VER: \"${VER}\"";

	if [ "${1}" == "" ];
	then
		echo "ERROR: invalid version \"${VER}\"";
		return 1;
	fi


	if [ ! -d /usr/bin ];
	then
		echo "ERROR: dir /usr/bin is not found";
		return 1;
	fi
	cd /usr/bin;


	set_internal "${VER}" "cpp"                         "cpp-"
	set_internal "${VER}" "g++"                         "g++-"
	set_internal "${VER}" "gcc"                         "gcc-"
	set_internal "${VER}" "gcc-ar"                      "gcc-ar-"
	set_internal "${VER}" "gcc-nm"                      "gcc-nm-"
	set_internal "${VER}" "gcc-ranlib"                  "gcc-ranlib-"
	set_internal "${VER}" "gcov"                        "gcov-"
	set_internal "${VER}" "gcov-dump"                   "gcov-dump-"
	set_internal "${VER}" "gcov-tool"                   "gcov-tool-"
	set_internal "${VER}" "lto-dump"                    "lto-dump-"
	set_internal "${VER}" "x86_64-linux-gnu-cpp"        "x86_64-linux-gnu-cpp-"
	set_internal "${VER}" "x86_64-linux-gnu-g++"        "x86_64-linux-gnu-g++-"
	set_internal "${VER}" "x86_64-linux-gnu-gcc"        "x86_64-linux-gnu-gcc-"
	set_internal "${VER}" "x86_64-linux-gnu-gcc-ar"     "x86_64-linux-gnu-gcc-ar-"
	set_internal "${VER}" "x86_64-linux-gnu-gcc-nm"     "x86_64-linux-gnu-gcc-nm-"
	set_internal "${VER}" "x86_64-linux-gnu-gcc-ranlib" "x86_64-linux-gnu-gcc-ranlib-"
	set_internal "${VER}" "x86_64-linux-gnu-gcov"       "x86_64-linux-gnu-gcov-"
	set_internal "${VER}" "x86_64-linux-gnu-gcov-dump"  "x86_64-linux-gnu-gcov-dump-"
	set_internal "${VER}" "x86_64-linux-gnu-gcov-tool"  "x86_64-linux-gnu-gcov-tool-"
	set_internal "${VER}" "x86_64-linux-gnu-lto-dump"   "x86_64-linux-gnu-lto-dump-"


	return 0;
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# help function
function help()
{
	echo "example: ${1} [ list | set VERSION ]";
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# general function
function main()
{
# check depends tools
	check_prog "basename dirname echo file find grep ionice ln ls mktemp mv nice printf readlink rm sed sort stat tar touch uniq wc";
	if [ "${?}" != "0" ];
	then
		return 1;
	fi


# check args
	if [ "${1}" == "list" ];
	then
		list;
		return 0;
	fi


	if [ "${1}" == "set" ];
	then
		set "${2}";
		return 0;
	fi


	help "${0}";


	return 0;
}
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
main "${@}";

exit "${?}";
#---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
